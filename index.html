<!DOCTYPE HTML>
<html lang="us">
<head>
    <meta charset="utf-8">
    
    <title>WAVED</title>
    <link rel="icon" href="images/favicon.ico" type="image/x-icon" />
    
    <!-- CSS -->
    <link rel="stylesheet" href="ThirdParty/jquery/css/waved-theme/jquery-ui-1.10.4.custom.min.css">
    <link rel="stylesheet" type="text/css" href="CSS/WAVED.css">
    
    <!-- JavaScript-->
    <!-- <script src="ThirdParty/d3/d3.v3.min.js" type="text/javascript" type="text/javascript"/> -->
    <script data-main="Source/main" src="ThirdParty/requirejs/require.js"></script>
</head>
<body>
    <div id="mainSection" class="hide-on-load">
        <div id="header-container">
                <div class="inline bottom" id="header-logo-container">
                    <a href="http://kshsk.github.io/WAVED/" target="_blank">
                        <img id="header-logo" src="images/logo/WAVED_HighRes_Color_NoText.png" ondragstart="return false;" />
                    </a>
                </div>
                <div class="inline bottom">
                    <div>
                        <span class="menu-text" id="project-name" data-bind="text: currentProject.name"></span>
                        <span class="dirty" data-bind="visible: dirty"> (Unsaved Changes)</span>
                    </div>
                    
                    <button class="inline" id="new-button" data-bind="click: tryToCreateNewProject">New</button>
                    <button class="inline" id="load-button" data-bind="click: tryToLoadProject">Load</button>

                    <button class="inline" id="undo-button">Undo</button>
                    <button class="inline" id="redo-button">Redo</button>
                
                    <button class="inline" id="save-button" data-bind="click: saveProject">Save</button>
                    <button class="inline" id="save-as-button">Save As</button>
                    
                    <button class="inline" id="export-button">Export</button>
                
                    <span class="menu-text">Select: </span>
                    <select class="inline" 
                            id="widget-select" 
                            data-bind="options: currentProject.components, 
                                optionsText: function(item) {
                                   return item.viewModel.name.value;
                                }, value: selectedWidget">
                    </select>
                    <button class="inline" id="refresh-button">Refresh</button>
                </div>                
        </div>
        
        <div id="accordion-container" class="inline top">
            <div id="accordion">
                <h3>Project Tree</h3>
                <div>
	                <button class="right button-small delete-icon-button" data-bind="click: tryToDeleteFromProjectTree">Delete</button>
	                <ul id='project-tree' data-bind="visible: currentProject.name">
	                	<li class="tree-folder-icon">
	                			<a class="tree-row" data-bind="css: {'tree-row-selected': isSelectedInProjectTree(projectTree.SelectedTypeEnum.PROJECT, currentProject.name) },text: currentProject.name, click: selectInProjectTree(projectTree.SelectedTypeEnum.PROJECT, currentProject.name)"></a>
	                		<ul>
	                			<li class="tree-folder-icon">
	                				Components
			                		<ul data-bind="foreach: currentProject.components">
			                			<li class="tree-gear-icon" data-bind="css: {'tree-row-selected': $parent.isSelectedInProjectTree($parent.projectTree.SelectedTypeEnum.COMPONENT, $data) }">
			                				<a class="tree-row" data-bind="text: $data.viewModel.name.value, click: $parent.selectInProjectTree($parent.projectTree.SelectedTypeEnum.COMPONENT, $data)"></a>
			                				<!-- TODO: Elements -->
			               				</li>
			                		</ul>
		                		</li>
		                		<li class="tree-folder-icon">
		                			Data
		                			<ul data-bind="foreach: currentProject.unmarkedDataSets">
			                			<li class="tree-gear-icon" data-bind="css: {'tree-row-selected': $parent.isSelectedInProjectTree($parent.projectTree.SelectedTypeEnum.DATA, $data) }">
			                				<a class="tree-row" data-bind="text: $data.name, click: $parent.selectInProjectTree($parent.projectTree.SelectedTypeEnum.DATA, $data)"></a>
			               				</li>
			                		</ul>
	                			</li>
		                		<li class="tree-folder-icon">
		                			Actions
		                			<ul data-bind="foreach: currentProject.actions">
			                			<li class="tree-gear-icon" data-bind="css: {'tree-row-selected': $parent.isSelectedInProjectTree($parent.projectTree.SelectedTypeEnum.ACTION, $data) }">
			                				<a class="tree-row" data-bind="text: $data.name, click: $parent.selectInProjectTree($parent.projectTree.SelectedTypeEnum.ACTION, $data)"></a>
			               				</li>
			                		</ul>
	                			</li>
		                		<li class="tree-folder-icon">
		                			Events
		                			<ul data-bind="foreach: currentProject.events">
			                			<li class="tree-gear-icon" data-bind="css: {'tree-row-selected': $parent.isSelectedInProjectTree($parent.projectTree.SelectedTypeEnum.EVENT, $data) }">
			                				<a class="tree-row" data-bind="text: $data.name, click: $parent.selectInProjectTree($parent.projectTree.SelectedTypeEnum.EVENT, $data)"></a>
			               				</li>
			                		</ul>
	                			</li>
	                		</ul>
	                	</li>
	                </ul>
                </div>
                <h3>Widgets</h3>
                <div id="widgets-panel" data-bind="foreach: availableWidgets">
                    <button data-bind="text: $data.name, click: $parent.addNewWidget"></button><br>
                </div>
                <h3>Data</h3>
                <div>
                    <div>
                        <div>
                            <div class="inline">Source Files</div>
                            <div class="inline right">
                                <button class="button-small add-icon-button" data-bind="click: tryToUploadData">Add Data File</button>
                                <button class="button-small delete-icon-button" data-bind="click: markDataForDeletion">Delete Data File</button>
                            </div>
                        </div>
                        <select id="data-file-list" size="5" class="select-full-size"
                            data-bind="options: currentProject.unmarkedDataSets, 
                                optionsText: function(item) {
                                   return item.name + ' : ' + item.filename;
                                }, value: selectedDataSet"></select>
                    </div>
                    <br />
                    <div>
                        <div>
                            <div class="inline">Data Subsets</div>
                            <div class="inline right">
                                <button class="button-small add-icon-button">Add Data Subset</button>
                                <button class="button-small edit-icon-button">Edit Data Subset</button>
                                <button class="button-small delete-icon-button">Delete Data Subset</button>
                            </div>
                        </div>
                        <select id="data-subset-list" size="5" class="select-full-size"></select>
                    </div>
                </div>
                <h3>Actions</h3>
                <div>
                    <div>
                        <div>
                            <div class="inline">Actions</div>
                            <div class="inline right">
                                <button class="button-small add-icon-button" data-bind="click: addAction">Add Action</button>
                                <button class="button-small edit-icon-button" data-bind="click: editAction">Edit Action</button>
                                <button class="button-small delete-icon-button" data-bind="click: removeSelectedAction">Delete Action</button>
                            </div>
                        </div>
                        <select id="action-list" size="10" class="select-full-size" 
                                data-bind="options: currentProject.actions,
                                optionsText: function(action) {
                                   return action.name;
                                }, value: selectedAction"></select>
                    </div>
                </div>
                <h3>Events</h3>
                <div>
                    <div>
                        <div>
                            <div class="inline">Events</div>
                            <div class="inline right">
                                <button class="button-small add-icon-button" data-bind="click: addEvent">Add Event</button>
                                <button class="button-small edit-icon-button" data-bind="click: editEvent">Edit Event</button>
                                <button class="button-small delete-icon-button" data-bind="click: removeSelectedEvent">Delete Event</button>
                            </div>
                        </div>
                        <select id="event-list" size="10" class="select-full-size"
                                data-bind="options: currentProject.events,
                                optionsText: function(event) {
                                    return event.name;
                                }, value: selectedEvent"></select>
                    </div>
                </div>
                <h3>Properties</h3>
                <div id="properties-panel">
                    <div id="properties-panel-properties" data-bind="foreach: currentProject.components">
                        <div data-bind="foreach: $data.viewModel.properties, visible: $parent.selectedWidget == $data">
                            <div data-bind="template: {name : $data.templateName, data: $data}"></div>
                        </div>
                    </div>
                    <div id="properties-panel-bound-data" data-bind="visible: selectedWidget && selectedWidget.viewModel.boundData !== 'undefined'">                        
                        <div data-bind="visible: selectedWidget && typeof selectedWidget.viewModel.boundData !== 'undefined'">
                            <hr/>
                            <div class="inline">Bound Data</div>
                            <div class="inline right">
                                <button data-bind="click: tryToBindData" class="button-small add-icon-button">Bind Data</button>
                                <button data-bind="click: unbindData" class="button-small delete-icon-button">Unbind Data</button>
                            </div>
                        
                            <div data-bind="if: selectedWidget && typeof selectedWidget.viewModel.boundData !== 'undefined'">
                                <select id="bound-data-list" size="5" class="select-full-size"
                                    data-bind="options: selectedWidget.viewModel.boundData, 
                                        optionsText: function(name) {
                                           return name + ' : ' + currentProject.getDataSet(name).filename;
                                        }, value: selectedBoundData">
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <h3>Google Analytics</h3>
                <div>
                    <div>
                        <div class="inline" data-bind="visible: !currentProject.googleAnalytics.bound">
                            <label class="inline">Google Analytics UA Code</label>
                            <input type="text" data-bind="value: currentProject.googleAnalytics.uaCode.value, valueUpdate: 'keyup'"/>
                            <div class="error" data-bind="visible: currentProject.googleAnalytics.uaCode.error, html: currentProject.googleAnalytics.uaCode.message"></div>
                            <label class="inline">Google Analytics Event Category</label>
                            <input type="text" data-bind="value: currentProject.googleAnalytics.eventCategory.value, valueUpdate: 'keyup'" />
                            <div class="error" data-bind="visible: currentProject.googleAnalytics.eventCategory.error, html:currentProject.googleAnalytics.eventCategory.message"></div>
                            <div class="submit-button-panel">
                               <button id="google-analytics-add-button" class="button-small submit-button" data-bind="click: currentProject.googleAnalytics.set;">Add</button>
                               <button id="google-analytics-clear-button" class="button-small" data-bind="click: currentProject.googleAnalytics.clear">Clear</button>
                            </div>
                        </div>
                        <div class="inline" data-bind="visible: currentProject.googleAnalytics.bound">
                            <span>UA: </span><span data-bind="text: currentProject.googleAnalytics.uaCode.value"></span>
                            <br>
                            <span>Event Category: </span><span data-bind="text: currentProject.googleAnalytics.eventCategory.value"></span>
                            <div>
                                <button id="google-analytics-remove-button" class="button-small" data-bind="click: currentProject.googleAnalytics.unset" style="float:center;">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="workspace-container" class="inline top">
            <div id="waved-workspace" data-bind="style: {height: currentProject.workspace.height.value + 'px', width: currentProject.workspace.width.value + 'px'}">
            </div>
        </div>
        
    </div>
    
    <!-- The dialogs need to be outside the hidden section or they are not created correctly. -->
    <div id="welcome-dialog" title="Welcome to WAVED!" class="dialog">
        <p>Would you like to create a new project or load an existing one?</p>
    </div>
    
    <div id="create-new-project-dialog" title="New Project" class="dialog">
        <p>Please create a new project</p>
        <label class="required">Project Name: <input id="create-new-project-name" data-bind="value: newProjectName.value, valueUpdate: 'keyup'"/> </label>
        <div class="error" data-bind="visible: newProjectName.error, html: newProjectName.message"></div>
    </div>
    
    <div id="delete-project-dialog" title="Delete Project" class="dialog">
        <p>Are you sure you want to delete this project?</p>
        <p>This action cannot be undone!</p>
        <div class="error"></div>
    </div>

    <div id="load-project-dialog" title="Load Project" class="dialog">
        <p>Please select an existing project to load.</p>
        <label class="required">Project Name: 
            <select id="load-project-select"
                data-bind="options: projectList, value: loadProjectName.value">
            </select>
            <button class="button-small refresh-icon-button" data-bind="click: updateProjectList">Refresh List</button>
        </label>
        <div class="error" data-bind="visible: loadProjectName.error, html: loadProjectName.message"></div>
    </div>
    
    <div id="upload-data-dialog" title="Upload Data" class="dialog">
        <div>
            <label class="required" for="upload-data-name">Name: </label>
            <input id="upload-data-name" type="text" data-bind="value: uploadDataName.value, valueUpdate: 'keyup'"/>
            <div class="error" data-bind="visible: uploadDataName.error, html: uploadDataName.message"></div>
        </div>
        <div>
            <label class="required" for="upload-data-file">File: </label>
            <input id="upload-data-file" type="file" accept=".csv,.json" data-bind="value: uploadDataFile.value, valueUpdate: 'keyup'"/>
            <div class="error" data-bind="visible: uploadDataFile.error, html: uploadDataFile.message"></div>
        </div>
    </div>
    
    <div id="bind-data-dialog" title="Bind Data" class="dialog">
        <button id="bind-data-add-data-file-button" class="right" data-bind="click: tryToUploadData">Upload</button>
        <table id="bind-data-table">
            <thead>
                <tr>
                    <th>Include</th>
                    <th>Name</th>
                    <th>File</th>
                </tr>
            </thead>
            <tbody id="bind-data-options" data-bind="foreach: availableDataForBinding">
                <tr>
                    <td>
                        <input type="checkbox" class="bind-data-selections"
                            data-bind="attr: {'data-name': $data.name}" />
                    </td>
                    <td data-bind="text: $data.name"></td>
                    <td data-bind="text: $data.filename"></td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div id="action-editor-dialog" title="Action Editor" class="dialog">
        <div class="inline top padding15 dialogColumnMaxWidth">
            <div class="required">Action Name:</div>
            <div class="marginBottom10">
                   <input data-bind="value: selectedActionName.value, valueUpdate: 'keyup'"/>
                   <div class="error" data-bind="visible: selectedActionName.error, html: selectedActionName.message"></div>
            </div>
            <div>Action Type:</div>
            <select class="marginBottom10 width100"
                    data-bind="options: ['Property Action', 'Query Action'],
                    value: selectedActionType">
            </select>
            <div>Affected Component:</div>
            <select class="marginBottom10 width100"
                    data-bind="options: currentProject.components, 
                      optionsText: function(component) {
                         return component.viewModel.name.value;
                      },
                  value: actionEditorAffectedComponent">
            </select>
            <!-- ko if: selectedActionType === 'Query Action' -->
            <div>Dataset:</div>
            <select class="marginBottom10 width100"
                    data-bind="optionsCaption: 'None',
                    options: currentProject.dataSets, 
                      optionsText: function(dataSet) {
                           return dataSet.name;
                      },
                  value: actionEditorDataSet">
            </select>
            <!-- /ko -->
            <div>
                <input type="checkbox" id="actionApplyAutomatically"></input>
                <span>Apply Automatically</span>
            </div>
        </div>
        <div class="inline top padding15">
            <div>Options</div>
            <!-- ko if: selectedActionType === 'Property Action' -->
            <div data-bind="foreach: actionEditorAffectedComponent.viewModel.properties">
                <!-- ko if:  $data.displayName !== 'Name' -->
                <div data-bind="template: {name : $data.displayTemplateName, data: $data}"></div>
                <!-- /ko -->
            </div>
            <!-- /ko -->
            <!-- ko if: selectedActionType === 'Query Action' -->
            <!-- TODO: Query Action Options -->
            <!-- /ko -->
        </div>
    </div>
    
    <div id="event-editor-dialog" title="Event Editor" class="dialog">
        <div>
            <label class="inline required">Name: </label>
            <input type="text" data-bind="value: selectedEventName.value, valueUpdate: 'keyup'"/>
            <div class="error" data-bind="visible: selectedEventName.error, html: selectedEventName.message"></div>
        </div>
        <div>
            <label class="inline">Event: </label>
            <select data-bind="options: eventTypes, value: selectedEventType"></select>
        </div>
        <div>
            <label class="inline">Triggering Component: </label>
            <select data-bind="options: currentProject.components,
                            optionsText: function(component) {
                                return component.viewModel.name.value;
                            }, value: eventEditorTriggeringComponent"></select>
        </div>
        <div>
            <label class="inline">Trigger: </label>
            <select data-bind="options: eventEditorTriggeringComponent.viewModel.triggers,
                            optionsText: function(trigger) {
                                return trigger.name;
                            }, value: eventEditorTrigger"></select>
        </div>
        <div>
            <div>
            Action:
            <button class="button-small add-icon-button right" data-bind="click: addAction">Add Action</button>
            </div>
            <div data-bind="foreach: currentProject.actions">
                <div>
                    <input type="checkbox" data-bind="checkedValue: $data, checked: $root.selectedEventActions"></input>
                    <span data-bind="text: $data.name"></span>
                </div>
            </div>
        </div>
        
    </div>
    
    <div id="unsaved-changes-dialog" title="Unsaved Changes" class="dialog">
        <p>You have unsaved changes. Please discard your changes or cancel to continue working with the current project.</p>
    </div>
    
    <div id="error-dialog" title="" class="dialog">
        <p id="error-dialog-message"></p>
    </div>
</body>
</html> 

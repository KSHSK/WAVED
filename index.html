<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>WAVED (Prototype)</title>
        <link rel="shortcut icon" href="/favicon.ico" />
        <script src="http://d3js.org/d3.v3.min.js"></script>
    	<script src="https://code.jquery.com/jquery-1.9.1.js"></script>
		<script src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    	<link rel="stylesheet" type="text/css" href="style/style.css">
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    	
    	<script type="text/javascript" src="js/components/constants.js"></script>
    	<script type="text/javascript" src="js/components/us_map.js"></script>
    	
    	<script type="text/javascript">
    		$(document).ready(function(){
				$("#map-colorize-button").attr("disabled", "disabled");
    			$("#map-bind-data-button").attr("disabled", "disabled");
				$("#map-render-markers-button").attr("disabled", "disabled");
    		});
    	</script>
    </head>
    <body id="main-body">
    	<div id="header-container">
    		<a href="http://kshsk.github.io/WAVED/" target="_blank"><img id="header-logo" src="images/WAVED.png" ondragstart="return false;" /></a>
    	</div>
    	<div id="main-container">
    		<div id="widget-panel">
    			<div class="widget-header">Save/Load</div>
    			<button onclick="save_state()">Save State</button></br>
    			<button onclick="load_state()">Load State</button></br>
    			
    			<div class="widget-header">Widget Controls</div>
    			<button id="map-generate-button" onclick="us_map.generate(); $(this).attr('disabled','disabled');">Add Map Widget</button><br>
    			<button id="map-colorize-button" onclick="us_map.colorize()">Colorize Map</button><br>
    			<select id="data-sources">
    				<option value="">Select data to bind...</option>
    				<option value="data/data_full.csv">data/data_full.csv</option>
    			</select>
    			<button id="map-bind-data-button" onclick="bind_csv()">Bind data</button><br>
    			<button id="map-render-markers-button" onclick="us_map.circle_element.render()">Render city markers</button><br>
    			
    			<div id="widget-selector-container">
    				<div class="widget-header">Widgets</div>
					<select id="widget-selector" size="5"></select>
    			</div>
    			<div id="data-selector-container">
    				<div class="widget-header">Data</div>
					<select id="data-selector" size="5"></select>
    			</div>
    			
    			<div class="widget-header">Debug</div>
				<button onclick="log_svg()">[Debug] Log SVG</button><br>
    		</div>
    		<div id="workspace-panel">
    			<div id="workspace-header">Map Panel</div>
    			<iframe id="workspace-preview" seamless>
    			</iframe>
    		</div>
    	</div>
    	<script>
    		var state = {};
    		
    		$(document).ready(function(){
    			$.extend(state, {"widgets":{}});
    		});
    	
    		function log_svg(){
    			console.log(us_map.get_svg());
    			console.dir("Bound data: " + us_map.data.length);
    			console.dir(state);
    		}
    		
    		function bind_csv(){
    			var value = $("#data-sources").val()
    			if(value != ""){
    				us_map.bind_data(value);
    				alert("Data bound!");
    			} else {
    				alert("No data selected");
    			}
    		}
    		
    		function load_state(){
    			// TODO: Actually get the state
    			var saved_state = {
    				"widgets": {
    					"us_map": {
    						"bound_data": ["data/data_full.csv"],
    						"circle_element": 1,
    						"render": 1,
    						"color": 1
		   				}
    				}
    			};
    			
    			// Clear the iFrame
    			var map_preview_document = $("#" + constants.MAP_PREVIEW_ID).contents();
				map_preview_document.find('head').empty();
				map_preview_document.find('body').empty();
    			
    			us_map.load_state(saved_state.widgets.us_map);
    		}
    		
    		function save_state(){
    			// Do something
    			alert("This button doesn't do anything!");
    		}
    	</script>
    </body>
</html>